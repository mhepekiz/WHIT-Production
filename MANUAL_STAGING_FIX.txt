#!/bin/bash

echo "ðŸš¨ IMMEDIATE STAGING FIX - Manual Steps Required"
echo "================================================"
echo ""
echo "Since SSH automation isn't working, please copy these commands and run them manually:"
echo ""
echo "1. Open Terminal and run:"
echo "   ssh root@45.79.211.144"
echo ""
echo "2. When connected, copy and paste these commands one by one:"
echo ""
echo "# Navigate to project"
echo "cd /var/www/whit-release"
echo ""
echo "# Create correct environment file"  
echo "echo 'VITE_API_URL=https://staging.whoishiringintech.com/api' > frontend/.env"
echo ""
echo "# Kill existing processes"
echo "pkill -f 'manage.py runserver' || true"
echo "pkill -f 'gunicorn' || true" 
echo "pkill -f 'npm' || true"
echo ""
echo "# Wait a moment"
echo "sleep 5"
echo ""
echo "# Build frontend with correct API URL"
echo "cd frontend"
echo "export VITE_API_URL=https://staging.whoishiringintech.com/api"
echo "npm run build"
echo ""
echo "# Start backend"
echo "cd ../backend"
echo "nohup python manage.py runserver 127.0.0.1:8000 > /var/log/whit-backend.log 2>&1 &"
echo ""
echo "# Test the fix"
echo "curl -I https://staging.whoishiringintech.com/api/health/"
echo ""
echo "3. After running these commands, test the staging site:"
echo "   https://staging.whoishiringintech.com"
echo ""
echo "ðŸŽ¯ What this fixes:"
echo "âœ… Frontend will use staging API instead of production"
echo "âœ… CORS errors will disappear"
echo "âœ… Companies will load successfully"
echo "âœ… 'Failed to load companies' error will be gone"
echo ""
echo "ðŸ“Š You should see:"
echo "- API calls going to 'staging.whoishiringintech.com/api'"
echo "- No more CORS policy errors in browser console"
echo "- Companies loading without errors"